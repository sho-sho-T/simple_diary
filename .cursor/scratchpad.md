# このファイルの説明(編集不可)
このスクラッチパッドファイルは、タスク管理および実装計画のためのものです。
取り組むタスクにおける作業計画をチェックボックス形式で記述します。

- [X] = 完了 (100% 完了、検証済み)
- [-] = 進行中 (積極的に作業中)
- [ ] = 計画 (未開始)
- [!] = ブロック (依存関係あり)
- [?] = レビューが必要 (検証が必要)

# 作業計画(編集可)

ステータス: [Planning]
確信度: [80%]
最終更新日: 2024-05-18

## 日記アプリケーション実装計画

### Phase 1: バックエンド基盤構築
[ID-001] データベース準備
- [ ] Prismaスキーマの最終確認
- [ ] マイグレーションコマンド実行 (`npx prisma db push`)
- [ ] データベース接続のテスト

[ID-002] APIエンドポイント実装: 日記エントリー関連
- [ ] `GET /api/diary` - 全日記エントリー取得
- [ ] `GET /api/diary/:date` - 特定日付の日記エントリー取得
- [ ] `POST /api/diary` - 日記エントリー作成
- [ ] `PUT /api/diary/:id` - 日記エントリー更新
- [ ] `DELETE /api/diary/:id` - 日記エントリー削除
- [ ] `GET /api/diary/similar-dates` - 過去の同日の日記取得

[ID-003] APIエンドポイント実装: タグ関連
- [ ] `GET /api/tags` - タグ一覧取得
- [ ] `POST /api/tags` - タグ作成
- [ ] `PUT /api/tags/:id` - タグ更新
- [ ] `DELETE /api/tags/:id` - タグ削除（未使用タグのみ）

### Phase 2: フロントエンド実装
[ID-004] 共通UIコンポーネント構築
- [ ] レイアウトとナビゲーション
- [ ] 日記エントリーカードコンポーネント
- [ ] タグ表示・選択コンポーネント
- [ ] 感情スタンプ選択コンポーネント
- [ ] 基本的なUIライブラリのセットアップ (shadcn/ui)

[ID-005] マークダウンエディタ実装
- [ ] リアルタイムプレビュー機能
- [ ] ツールバーと基本的なマークダウン操作
- [ ] react-markdownの統合

[ID-006] カレンダーと日記表示画面
- [ ] 月間カレンダーの実装 (react-day-picker)
- [ ] 日付選択時の日記表示
- [ ] 過去の同日日記表示機能

[ID-007] 日記作成・編集フォーム
- [ ] 日記テキスト入力部分
- [ ] タグ選択・作成機能
- [ ] 感情スタンプ選択機能
- [ ] Zodバリデーション統合

### Phase 3: 認証と権限管理
[ID-008] Next Auth認証統合
- [ ] ログイン/ログアウト機能
- [ ] セッション管理
- [ ] 認証状態によるUI適応
- [ ] 保護されたルートの設定

### Phase 4: 追加機能実装
[ID-009] タグ検索・フィルタリング機能
- [ ] タグベースの日記フィルタリング
- [ ] タグクラウド/タグリスト表示
- [ ] タグ管理インターフェース

[ID-010] 感情スタンプの可視化
- [ ] 感情スタンプの時系列分析
- [ ] カレンダーでの感情表示

### Phase 5: 最適化とテスト
[ID-011] パフォーマンス最適化
- [ ] サーバーコンポーネントとクライアントコンポーネントの適切な使い分け
- [ ] データフェッチ最適化
- [ ] レンダリング戦略の改善

[ID-012] テストとバグ修正
- [ ] 単体テスト作成
- [ ] E2Eテスト作成
- [ ] エッジケースの検証

## 技術的な考慮事項と注意点

### データベース関連
- Prismaスキーマ変更後は必ずマイグレーションコマンドを実行すること
- 推奨コマンド: `npx prisma db push` または `npx prisma migrate dev --name xxx`
- エラー発生時は `npx prisma migrate dev --create-only` と `npx prisma migrate deploy` の組み合わせを試す

### 実装ガイドライン
- バリデーション: Zodを使用
- エラーハンドリング: グローバルエラーハンドリング
- パフォーマンス: サーバーコンポーネントでデータフェッチを行う
- レスポンシブデザイン: モバイルファースト
- shadcn/uiコンポーネントを活用

### 制約条件
- タグ削除時、使用中のタグは削除不可
- 日記は日付ごとに1エントリーのみ
- エラーケースの適切なハンドリング